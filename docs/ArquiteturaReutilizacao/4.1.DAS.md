# 4.1 Documento de Arquitetura de Software (DAS)

## Introdução

O **Correio Digital** (também conhecido como BabelChat) é uma plataforma web cujo objetivo principal é conectar pessoas interessadas em aprender e praticar diferentes idiomas. O sistema oferece funcionalidades de criação de perfil, gerenciamento de interesses, publicação de posts, adição de amigos e um sistema de chat interativo para prática de conversação.

### Propósito
O sistema foi desenvolvido para facilitar o aprendizado de idiomas através da interação social, permitindo que usuários pratiquem conversas em tempo real com falantes nativos ou outros estudantes, criando um ambiente colaborativo e engajador.

### Público-Alvo
- Estudantes de idiomas que buscam prática conversacional
- Pessoas interessadas em intercâmbio cultural e linguístico
- Usuários que desejam aprimorar suas habilidades de comunicação em línguas estrangeiras

### Escopo do Documento
Este Documento de Arquitetura de Software (DAS) apresenta uma visão abrangente da arquitetura do sistema Correio Digital, descrevendo suas principais decisões arquiteturais, componentes, padrões de projeto utilizados e características de qualidade. O documento serve como guia técnico para desenvolvedores, arquitetos e stakeholders do projeto.

[[1](#ref1)]

---

##  Representação Arquitetural

### Abordagem Arquitetural
O sistema Correio Digital adota uma **arquitetura em camadas** baseada no modelo **Cliente-Servidor**, com separação clara de responsabilidades entre apresentação, lógica de negócio e persistência de dados.

### Componentes Principais

#### 1. Camada de Frontend/Interface
- **Tecnologia**: Next.js / React
- **Responsabilidades**: Gerenciamento de perfis, chat, exploração de usuários, publicações (feed)
- **Componentes**: InterfacePerfil, InterfaceChat, InterfaceGrupo, InterfaceApp

#### 2. Camada de Backend/Operações
- **Tecnologia**: FastAPI (Python) / Java
- **Responsabilidades**: Lógica de negócio, autenticação, notificações, gerenciamento de chat, sugestão de amigos, gamificação
- **Serviços**: ControladorAutenticacao, ControladorChat, ControladorNotificacoes, ControladorGamificacao

#### 3. Camada de Dados
- **Tecnologia**: PostgreSQL (banco relacional)
- **Responsabilidades**: Persistência de usuários, mensagens, conversas, perfis, conquistas
- **Componentes**: BancoDeDados, BancoDeDadosGamificacao

#### 4. Serviços Externos
- **APIs de Tradução**: Google Translate, DeepL (via padrão Adapter)
- **Sistema de Notificações**: E-mail e SMS (via padrão Abstract Factory)

### Estilo Arquitetural
O sistema segue os princípios de **Arquitetura em Camadas** com aplicação extensiva de **Padrões de Projeto GoF**, incluindo:
- **Criacionais**: Factory Method, Abstract Factory, Builder, Singleton
- **Estruturais**: Adapter, Facade, Decorator, Composite
- **Comportamentais**: Strategy, Command, State

[[2](#ref2),[[3](#ref3)]]

## 4.1.3 Metas e Restrições Arquiteturais

### Metas
- **Alta Disponibilidade**: Sistema acessível 24/7 para suportar usuários em diferentes fusos horários
- **Segurança Robusta**: Proteção de dados pessoais, autenticação segura (JWT), criptografia de mensagens
- **Baixa Latência**: Mensagens em tempo real com resposta rápida no chat
- **Escalabilidade**: Suporte ao crescimento de usuários e volume de mensagens
- **Usabilidade**: Interface intuitiva similar a aplicativos de mensagem conhecidos (WhatsApp)
- **Gamificação**: Sistema de pontos e conquistas para engajar usuários no aprendizado

### Restrições
- **Tecnológicas**: Uso obrigatório de padrões de projeto GoF conforme requisitos acadêmicos
- **Conformidade**: Suporte a múltiplos idiomas através de APIs de tradução externas
- **Desempenho**: Tradução automática dependente de APIs de terceiros (Google Translate, DeepL)
- **Orçamento**: Projeto acadêmico sem custos de infraestrutura complexa
- **Tempo**: Desenvolvimento conforme cronograma da disciplina de Arquitetura e Desenho de Software
- **Plataforma**: Aplicação web responsiva compatível com navegadores modernos

[[2](#ref2)]

---

##  Visualização de Caso de Uso

Os principais casos de uso do sistema Correio Digital refletem as funcionalidades essenciais para a prática de idiomas e interação social.

### UC01 - Enviar Mensagem de Texto

<details>
<summary><b>UC01 - Enviar Mensagem de Texto</b></summary>

| Campo | Descrição |
|---|---|
| Nome | Enviar Mensagem de Texto |
| Ator Principal | Usuário Estudante |
| Atores Secundários | Sistema de Notificação, Banco de Dados |
| Pré-condições | Usuário autenticado, Conversa iniciada ou existente |
| Pós-condições | Mensagem armazenada e entregue ao destinatário |
| Fluxo Principal | 1. Usuário seleciona conversa<br>2. Digita mensagem<br>3. Sistema valida conteúdo<br>4. Sistema armazena mensagem<br>5. Sistema notifica destinatário<br>6. Mensagem exibida no chat |
| Fluxo Alternativo | Se usuário estiver offline, mensagem é armazenada e entregue quando online |
| Regras de Negócio | RN01: Mensagens suportam texto, emoji e reações<br>RN02: Histórico de conversas preservado |

</details>

### UC02 - Traduzir Mensagem

<details>
<summary><b>UC02 - Traduzir Mensagem</b></summary>

| Campo | Descrição |
|---|---|
| Nome | Traduzir Mensagem |
| Ator Principal | Usuário Estudante |
| Atores Secundários | API de Tradução (Google/DeepL), Sistema de Cache |
| Pré-condições | Mensagem recebida em idioma diferente do configurado |
| Pós-condições | Mensagem exibida no idioma desejado |
| Fluxo Principal | 1. Usuário solicita tradução<br>2. Sistema identifica idioma de origem<br>3. Sistema consulta API de tradução<br>4. Sistema armazena tradução em cache<br>5. Tradução exibida ao usuário |
| Fluxo Alternativo | Se API falhar, tenta serviço alternativo (padrão Adapter com fallback) |
| Regras de Negócio | RN03: Suporte a múltiplos idiomas<br>RN04: Cache de traduções para reduzir custo de API |

</details>

### UC03 - Gerenciar Perfil

<details>
<summary><b>UC03 - Gerenciar Perfil</b></summary>

| Campo | Descrição |
|---|---|
| Nome | Gerenciar Perfil de Usuário |
| Ator Principal | Usuário Estudante |
| Atores Secundários | Sistema de Validação |
| Pré-condições | Usuário autenticado |
| Pós-condições | Perfil atualizado com novas informações |
| Fluxo Principal | 1. Usuário acessa seu perfil<br>2. Edita biografia, tags de idiomas, emoji<br>3. Sistema valida informações<br>4. Sistema persiste alterações<br>5. Confirmação exibida |
| Fluxo Alternativo | Se dados inválidos, sistema exibe mensagem de erro |
| Regras de Negócio | RN05: Bio limitada a 500 caracteres<br>RN06: Tags representam idiomas de interesse |

</details>

### UC04 - Adicionar Amigo

<details>
<summary><b>UC04 - Adicionar Amigo/Conexão</b></summary>

| Campo | Descrição |
|---|---|
| Nome | Adicionar Amigo |
| Ator Principal | Usuário Estudante |
| Atores Secundários | Sistema de Sugestões, Sistema de Notificação |
| Pré-condições | Usuário autenticado, Perfil do amigo visualizado |
| Pós-condições | Conexão estabelecida, Notificação enviada |
| Fluxo Principal | 1. Usuário busca ou recebe sugestão de amigo<br>2. Visualiza perfil<br>3. Envia solicitação de amizade<br>4. Sistema notifica destinatário<br>5. Destinatário aceita<br>6. Conexão criada |
| Fluxo Alternativo | Se solicitação recusada, conexão não é criada |
| Regras de Negócio | RN07: Matching baseado em idiomas de interesse<br>RN08: Sugestões inteligentes de amigos |

</details>

### UC05 - Participar de Sala Temática

<details>
<summary><b>UC05 - Participar de Sala Temática</b></summary>

| Campo | Descrição |
|---|---|
| Nome | Participar de Sala Temática |
| Ator Principal | Usuário Estudante |
| Atores Secundários | Sistema de Salas, Moderador |
| Pré-condições | Usuário autenticado, Sala existente ou criada |
| Pós-condições | Usuário membro da sala, pode enviar mensagens em grupo |
| Fluxo Principal | 1. Usuário explora salas disponíveis<br>2. Seleciona sala de interesse (por idioma/tema)<br>3. Solicita entrada<br>4. Sistema adiciona à sala<br>5. Usuário pode interagir no chat em grupo |
| Fluxo Alternativo | Se sala privada, requer aprovação do moderador |
| Regras de Negócio | RN09: Salas organizadas por idioma e tema<br>RN10: Suporte a múltiplos participantes |

</details>

**Figura 1:** Representação UML do Diagrama de Caso de Uso (Usuário)

![Diagrama de Caso de Uso - Usuário](../Assets/DiagramaCasoUso.png)

**Autoria**: [Esther Sena](https://github.com/esmsena) e [Mariiana Neris](https://github.com/Maryyscreuza), 2025.

[[4](#ref4)]

----

##  Visualização Lógica

A organização do sistema segue uma arquitetura em três camadas principais:

### Camadas Lógicas

#### Camada de Apresentação (Frontend)
- **Tecnologia**: Next.js, React
- **Componentes**:
  - `InterfacePerfil`: Gerenciamento de perfis de usuário
  - `InterfaceChat`: Sistema de mensagens em tempo real
  - `InterfaceGrupo`: Gerenciamento de salas temáticas e grupos
  - `InterfaceApp`: Dashboard principal e navegação
  - `InterfaceExplorar`: Busca e descoberta de usuários

#### Camada de Lógica de Negócio (Backend)
- **Tecnologia**: FastAPI (Python) / Java
- **Pacotes**:
  - `Operações`: Serviços principais do sistema
    - `ControladorAutenticacao`: Gerenciamento de login/logout/sessões
    - `ControladorChat`: Lógica de mensagens em tempo real
    - `ControladorNotificacoes`: Envio de alertas e notificações
    - `ServicoTraducao`: Integração com APIs de tradução (padrão Adapter)
    - `SugerirAmigos`: Algoritmo de matching baseado em idiomas
    - `ControladorGamificacao`: Sistema de pontos e conquistas
  - `Segurança`: Autenticação, autorização e validação
  - `Idiomas`: Gerenciamento de múltiplos idiomas e traduções

#### Camada de Persistência (Dados)
- **Tecnologia**: PostgreSQL
- **Componentes**:
  - `BancoDeDados`: Persistência de usuários, mensagens, conversas
  - `BancoDeDadosGamificacao`: Persistência de pontos, conquistas, ranking
  - `RepositorioUsuario`: Operações CRUD de usuários
  - `RepositorioMensagem`: Operações CRUD de mensagens
  - `RepositorioConversa`: Gerenciamento de conversas e histórico

**Figura 2:** Diagrama de Pacotes

![Diagrama de Pacotes](../Assets/diagrama_de_pacotes_Esther_Marii.png)

**Autoria**: Esther Sena, Mariiana Neris, 2025.

### Classes Principais e Relacionamentos

**Figura 3:** Diagrama de Classes

![Diagrama de Classes](../Assets/diagrama_de_classes.png)

**Autoria**: João Pedro Costa, Julia Gabriela, 2025.

#### 1. Classe `Usuario`
```java
class Usuario {
  - id: int
  - nome: string
  - email: string
  - senha: string
  - idiomaNativo: string
  - idiomasInteresse: List<string>
  
  + autenticar(): boolean
  + atualizarPerfil(): void
  + adicionarAmigo(usuario: Usuario): void
  + removerAmigo(usuario: Usuario): void
  + criarPostagem(): Postagem
  + participarChat(chat: Chat): void
}
```

#### 2. Classe `Perfil`
```java
class Perfil {
  - bio: string
  - tags: List<string>
  - emoji: List<string>
  
  + editarPerfil(): void
  + visualizarPerfil(): void
}
```

#### 3. Classe `Chat`
```java
class Chat {
  - id: int
  - mensagens: List<Mensagem>
  - usuarios: List<Usuario>
  - tipo: TipoChat // INDIVIDUAL, GRUPO
  
  + enviarMensagem(conteudo: string): void
  + reagirMensagem(mensagem: Mensagem, reacao: string): void
  + iniciarConversa(usuario: Usuario): void
  + compartilharConteudo(arquivo: File): void
}
```

#### 4. Classe `Mensagem`
```java
class Mensagem {
  - id: int
  - conteudo: string
  - dataEnvio: datetime
  - remetente: Usuario
  - reacoes: List<Reacao>
  - traduzida: boolean
  
  + editarMensagem(novoConteudo: string): void
  + adicionarReacao(reacao: string): void
  + traduzir(idiomaDestino: string): string
}
```

#### 5. Classe `Gamificacao`
```java
class Gamificacao {
  - nivel: int
  - pontos: int
  - usuario: Usuario
  
  + adicionarPontos(quantidade: int): void
  + verificarNivel(): void
  + desbloquearConquista(conquista: Conquista): void
}
```

#### 6. Classe `SalaTematica`
```java
class SalaTematica {
  - id: int
  - nome: string
  - descricao: string
  - idioma: string
  - tema: string
  - usuarios: List<Usuario>
  - moderador: Usuario
  
  + entrarSala(usuario: Usuario): void
  + sairSala(usuario: Usuario): void
  + enviarMensagemGrupo(mensagem: Mensagem): void
}
```

#### Relacionamentos Principais
- `Usuario` (1) --- (1) `Perfil`: Associação
- `Usuario` (1) --- (N) `Chat`: Associação
- `Chat` (1) --- (N) `Mensagem`: Composição
- `Usuario` (1) --- (1) `Gamificacao`: Associação
- `Gamificacao` (1) --- (N) `Conquista`: Composição

[[3](#ref3)]

-----

## Visualização de Processo

A Visualização de Processo descreve os fluxos de execução e ciclos de vida dos principais processos do sistema Correio Digital, incluindo as interações síncronas e assíncronas entre componentes.

### Processos Principais

#### Processo do Cliente (Frontend)

O cliente (navegador web) executa uma aplicação Next.js/React responsável por:

1. **Inicialização**: Carrega a aplicação e estabelece conexão com o servidor via JWT
2. **Renderização**: Exibe a interface de usuário com componentes React (perfil, chat, grupos)
3. **Interação do Usuário**: Captura eventos (cliques, digitação, submit de formulários)
4. **Requisições HTTP**: Envia requisições REST ao backend para operações CRUD
5. **Comunicação em Tempo Real**: Mantém conexão WebSocket aberta para receber mensagens instantaneamente
6. **Cache Local**: Armazena dados em cache (localStorage/sessionStorage) para melhor performance

**Fluxo de Envio de Mensagem:**
```
Usuário digita mensagem
↓
Clique no botão enviar
↓
Validação local (frontend)
↓
Requisição POST ao backend (/api/messages)
↓
Aguarda confirmação do servidor
↓
Exibe mensagem na interface (otimista)
↓
Recebe confirmação e atualiza timestamp
```

#### Processo do Servidor (Backend/API)

O backend (FastAPI/Python ou Java) executa em múltiplas threads/processos, responsável por:

1. **Autenticação**: Valida JWT em cada requisição protegida
2. **Validação**: Verifica integridade e conformidade dos dados
3. **Lógica de Negócio**: Executa operações de chat, perfil, gamificação
4. **Persistência**: Armazena dados em PostgreSQL
5. **Notificações**: Envia notificações para usuários e e-mails
6. **Tradução**: Integra com APIs externas (Google Translate, DeepL)
7. **WebSocket**: Mantém canais abertos para comunicação em tempo real

**Fluxo de Recebimento de Mensagem:**
```
Requisição POST /api/messages recebida
↓
Validar JWT e autenticação
↓
Validar conteúdo da mensagem
↓
Salvar em MENSAGEM (banco de dados)
↓
Broadcast via WebSocket para participantes da conversa
↓
Criar notificação para usuários offline
↓
Retornar 200 OK com dados da mensagem
```

#### Processos Assíncronos

Tarefas não críticas são executadas assincronamente para não bloquear a requisição principal:

**1. Envio de Notificações por Email/SMS**
- Disparada quando: novo contato, solicitação de amizade, conquista desbloqueada
- Implementação: Fila de mensagens (Celery com Redis) ou job scheduler
- Prioridade: Baixa

**2. Tradução em Background**
- Se usuário solicita tradução de mensagem antiga
- Implementação: Task queue assíncrona
- Cache o resultado para futuras requisições

**3. Cálculo de Gamificação**
- Atualização de pontos, níveis e conquistas
- Disparada após eventos (enviar mensagem, 100 mensagens, etc.)
- Implementação: Event-driven via mensageria

**4. Limpeza de Dados Expirados**
- Remoção de sessões expiradas, cache obsoleto
- Executado em horários de baixo uso (job agendado)
- Implementação: Cron job ou scheduler (APScheduler)

### Diagrama de Sequência - Envio de Mensagem

```
Cliente                    Backend                  Banco de Dados    WebSocket
  |                          |                            |              |
  |---POST /api/messages---->|                            |              |
  |                          |                            |              |
  |                          |--Validar JWT----------->   |              |
  |                          |<--Token válido----------|  |              |
  |                          |                            |              |
  |                          |--INSERT INTO MENSAGEM---> |              |
  |                          |<--ID retornado---------|  |              |
  |                          |                            |              |
  |<--200 OK + mensagem------|                            |              |
  |                          |---Broadcast para grupo-----------|------> Participantes
  |                          |                            |              |
  |(mostrar otimista)        |--CREATE NOTIFICACAO-----> |              |
  |                          |<--OK--|              |
  |                          |                            |              |
```

### Threads e Concorrência

- **Thread Pool (Backend)**: Múltiplas threads para atender requisições HTTP simultâneas
- **WebSocket Manager**: Thread dedicada para gerenciar conexões WebSocket ativas
- **Job Worker**: Thread/processo para executar tarefas assíncronas da fila
- **Cache Thread**: Gerencia cache distribuído (Redis) com TTL

### Estados de uma Mensagem

```
[RASCUNHO] → [ENVIADA] → [ENTREGUE] → [LIDA]
                  ↓
            [TRADUZIDA]
                  ↓
            [COM_REACAO]
```

## Visualização de Deploy

### Infraestrutura e Implantação

O sistema Correio Digital segue um modelo de deploy em nuvem com separação clara entre frontend, backend e banco de dados, permitindo escalabilidade e confiabilidade.

#### Arquitetura Física de Deploy

```
┌─────────────────────────────────────────────────────────────────┐
│                      CLIENTE (Navegador)                        │
│                    HTTPS/WebSocket                              │
└──────┬──────────────────────────────────────────────────────────┘
       │
       ↓
┌─────────────────────────────────────────────────────────────────┐
│                    CDN / Edge Nodes                             │
│            (Cache estático - CSS, JS, imagens)                 │
└──────┬──────────────────────────────────────────────────────────┘
       │
       ↓
┌─────────────────────────────────────────────────────────────────┐
│                  FRONTEND (Vercel/Next.js)                      │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Instância 1: App React (Balanceador de Carga)          │  │
│  ├──────────────────────────────────────────────────────────┤  │
│  │  Instância 2: App React (Redundância)                   │  │
│  └──────────────────────────────────────────────────────────┘  │
└──────┬──────────────────────────────────────────────────────────┘
       │
       ↓ API REST + WebSocket
┌─────────────────────────────────────────────────────────────────┐
│                 API GATEWAY / Load Balancer                    │
│              (Nginx / AWS Load Balancer)                       │
└──────┬──────────────────────────────────────────────────────────┘
       │
       ├──────────────────────┬──────────────────────┐
       ↓                      ↓                      ↓
┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
│ BACKEND (Render/ │  │ BACKEND (Render/ │  │ BACKEND (Render/ │
│  AWS / Railway)  │  │  AWS / Railway)  │  │  AWS / Railway)  │
│                  │  │                  │  │                  │
│ FastAPI + Python │  │ FastAPI + Python │  │ FastAPI + Python │
│   (Instância 1)  │  │   (Instância 2)  │  │   (Instância 3)  │
│                  │  │                  │  │                  │
│ ├─ Operações     │  │ ├─ Operações     │  │ ├─ Operações     │
│ ├─ Autenticação  │  │ ├─ Autenticação  │  │ ├─ Autenticação  │
│ ├─ Chat WebSocket│  │ ├─ Chat WebSocket│  │ ├─ Chat WebSocket│
│ └─ Notificações  │  │ └─ Notificações  │  │ └─ Notificações  │
└──────┬───────────┘  └──────┬───────────┘  └──────┬───────────┘
       │                     │                     │
       └─────────────────────┼─────────────────────┘
                             ↓
        ┌────────────────────────────────────────┐
        │   CACHE DISTRIBUÍDO (Redis)            │
        │   - Sessions (JWT)                     │
        │   - Cache de traduções                 │
        │   - Fila de mensagens assíncronas      │
        └────────────────────┬───────────────────┘
                             ↓
        ┌────────────────────────────────────────┐
        │   BANCO DE DADOS (PostgreSQL)          │
        │   - Primary Node (Produção)            │
        │   - Replica Node (Backup/Leitura)      │
        │   - Backup automático (S3)             │
        └────────────────────────────────────────┘
                             ↓
        ┌────────────────────────────────────────┐
        │   ARMAZENAMENTO (AWS S3 / Cloudinary)  │
        │   - Fotos de perfil                    │
        │   - Arquivos compartilhados            │
        └────────────────────────────────────────┘
```

#### Plataformas de Deploy

##### Frontend (Next.js/React)
- **Plataforma**: Vercel ou Netlify
- **Recursos**:
  - Múltiplas instâncias para alta disponibilidade
  - CDN global para servir assets estáticos
  - Automatic deployments via Git (main branch)
  - HTTPS obrigatório
  - Preview deployments para PRs
- **Domínio**: correio-digital.vercel.app

##### Backend (FastAPI/Python)
- **Plataforma**: Render, Railway ou AWS EC2
- **Recursos**:
  - Container Docker para portabilidade
  - Múltiplas instâncias (mínimo 2 para HA)
  - Auto-scaling baseado em CPU/memória
  - Environment variables para configs sensíveis
  - Health checks para detecção de falhas
- **Domínio**: api.correio-digital.com

##### Banco de Dados (PostgreSQL)
- **Plataforma**: Render Managed PostgreSQL ou AWS RDS
- **Recursos**:
  - Replicação master-slave para alta disponibilidade
  - Backup automático diário (retenção 7 dias)
  - Logs de transação para disaster recovery
  - SSL para conexões criptografadas
  - Monitoramento de performance

##### Cache (Redis)
- **Plataforma**: Render Redis ou AWS ElastiCache
- **Recursos**:
  - Replicação para redundância
  - AOF (Append-Only File) para persistência
  - Auto-expiry de chaves
  - Monitoramento de memória

##### Email e SMS
- **Email**: SendGrid ou AWS SES
  - Envio de notificações, confirmações
  - Webhooks para delivery tracking
- **SMS**: Twilio
  - Notificações críticas via SMS

#### Variáveis de Ambiente

```bash
# Frontend (.env.local)
NEXT_PUBLIC_API_URL=https://api.correio-digital.com
NEXT_PUBLIC_WS_URL=wss://api.correio-digital.com/ws

# Backend (.env)
DATABASE_URL=postgresql://user:pass@db.render.com:5432/correio
REDIS_URL=redis://cache.render.com:6379/0
JWT_SECRET=sua_chave_secreta_aqui
GOOGLE_TRANSLATE_API_KEY=xxx
DEEPL_API_KEY=xxx
SENDGRID_API_KEY=xxx
```

#### Pipeline de CI/CD

```
Git Push (main branch)
    ↓
├─ Tests (Jest, Pytest)
├─ Linting (ESLint, Flake8)
├─ Build Frontend (Next.js)
├─ Build Backend (Docker image)
└─ Deploy (Vercel, Render)
    ↓
Produção
```

#### Monitoramento e Logging

**Figura 4:** Diagrama de Deploy (ou Arquitetura em Camadas Físicas)

- **APM (Application Performance Monitoring)**: DataDog ou New Relic
- **Logging Centralizado**: ELK Stack (Elasticsearch, Logstash, Kibana) ou CloudWatch
- **Alertas**: Slack, PagerDuty (erros críticos)
- **Uptime Monitoring**: UptimeRobot


**Autoria**: [Mariiana Neris](https://github.com/Maryyscreuza), 2025.

##  Visualização de Implementação

### Componentes de Software

A Visualização de Implementação descreve a estrutura modular do sistema, organizando componentes em subsistemas coerentes com responsabilidades bem definidas e interações claras.

#### Subsistemas e Componentes Principais

##### **Subsistema de Apresentação (Frontend)**
Responsável pela interface de usuário e interação com o usuário.

- **Componente InterfaceApp** (Container Principal)
  - Gerencia roteamento entre páginas (Chat, Perfil, Explorar, Grupos)
  - Mantém estado global (Redux/Context API)
  - Implementa tema (claro/escuro)
  - Responsabilidade: Orquestração da aplicação

- **Componente InterfaceChat**
  - Lista de conversas (sidebar)
  - Área de mensagens (histórico)
  - Input de mensagem com botões (enviar, anexar, emoji)
  - Indicadores de digitação, status de entrega
  - Responsabilidade: Renderização do chat em tempo real
  - Padrão: Composite (lista de mensagens como árvore)

- **Componente InterfacePerfil**
  - Exibição de avatar, nome, bio
  - Tags de idiomas (badges)
  - Botão para editar perfil
  - Status de gamificação (pontos, nível, conquistas)
  - Responsabilidade: Visualização e edição de perfil
  - Padrão: Observer (atualiza quando dados mudam)

- **Componente InterfaceGrupo**
  - Lista de salas temáticas disponíveis
  - Filtro por idioma e tema
  - Botão de entrada/saída
  - Chat em grupo similar ao chat individual
  - Responsabilidade: Gerenciamento de salas temáticas

- **Componente InterfaceExplorar**
  - Busca de usuários por idioma, localização
  - Cards com perfil resumido
  - Botão "Adicionar Amigo"
  - Sugestões inteligentes
  - Responsabilidade: Descoberta de usuários

---

##### **Subsistema de Operações (Backend - Lógica de Negócio)**
Responsável pela execução da lógica e regras de negócio.

- **Componente ControladorAutenticacao**
  - Registro de novo usuário (POST /auth/register)
  - Login e validação de credenciais
  - Emissão de JWT
  - Refresh token
  - Logout e invalidação de sessão
  - Responsabilidade: Gerenciamento de autenticação
  - Padrão: Singleton (uma instância única)
  - Padrão: Factory Method (criação de tokens)

- **Componente ControladorChat**
  - Envio de mensagem (POST /chat/messages)
  - Recuperação de histórico (GET /chat/conversations/{id})
  - Atualização de status de leitura
  - Adição de reações à mensagem
  - Edição/deleção de mensagem
  - Responsabilidade: Lógica de mensageria
  - Padrão: Command (encapsula ações de chat)
  - Padrão: Strategy (diferentes tipos de mensagem: texto, arquivo, reação)

- **Componente ControladorNotificacoes**
  - Criação de notificação (novo contato, mensagem, conquista)
  - Envio assíncrono (email, SMS, push)
  - Marcação como lida
  - Responsabilidade: Sistema de notificações
  - Padrão: Observer (observa eventos do sistema)
  - Padrão: Abstract Factory (criação de diferentes tipos de notificação)

- **Componente ServicoTraducao**
  - Integração com APIs externas (Google Translate, DeepL)
  - Cache de traduções (Redis)
  - Fallback entre provedores
  - Responsabilidade: Tradução de conteúdo
  - Padrão: Adapter (adapta múltiplas APIs)
  - Padrão: Facade (simplifica uso das APIs)
  - Padrão: Decorator (adiciona cache à tradução)

- **Componente SugerirAmigos**
  - Algoritmo de matching baseado em idiomas
  - Busca de usuários similares
  - Ranking de sugestões
  - Responsabilidade: Recomendação de conexões
  - Padrão: Strategy (diferentes algoritmos de matching)

- **Componente ControladorGamificacao**
  - Cálculo de pontos por ação (enviar mensagem, criar sala)
  - Determinação de nível baseado em pontos
  - Desbloqueio de conquistas
  - Ranking global
  - Responsabilidade: Sistema de pontos e badges
  - Padrão: State (diferentes níveis com comportamentos distintos)
  - Padrão: Command (ações que geram pontos)

---

##### **Subsistema de Comunicação em Tempo Real**
Responsável pela entrega instantânea de mensagens.

- **Componente WebSocketManager**
  - Gerenciamento de conexões WebSocket
  - Broadcasting de mensagens para grupo
  - Notificação de evento (usuário digitando, online/offline)
  - Responsabilidade: Comunicação bidirecional
  - Padrão: Observer (notifica todos os subscribers)
  - Padrão: Publish-Subscribe (canais por conversa)

- **Componente FilaAssincrona** (Message Queue)
  - Enfileiramento de tarefas (email, SMS, gamificação)
  - Processamento em background
  - Retry logic para falhas
  - Responsabilidade: Desacoplamento de operações
  - Padrão: Command (tarefas como objetos command)

---

##### **Subsistema de Segurança**
Responsável pela autenticação, autorização e validação.

- **Componente MiddlewareAutenticacao**
  - Validação de JWT em requisições
  - Extração de claims (user_id, permissões)
  - Rejeição de tokens expirados
  - Responsabilidade: Validação de autenticação
  - Padrão: Interceptor (intercepta todas as requisições)

- **Componente ValidadorDados**
  - Validação de email, senha, conteúdo
  - Sanitização contra XSS/Injection
  - Rate limiting
  - Responsabilidade: Proteção contra entradas malformadas
  - Padrão: Facade (centraliza validações)

- **Componente CriptografiaSenha**
  - Hashing de senhas (bcrypt/argon2)
  - Comparação segura
  - Responsabilidade: Segurança de credenciais
  - Padrão: Strategy (diferentes algoritmos de hash)

---

##### **Subsistema de Persistência (Dados)**
Responsável pelo armazenamento e recuperação de dados.

- **Componente RepositorioUsuario**
  - CRUD de usuários
  - Busca por email, nome
  - Responsabilidade: Operações de usuário
  - Padrão: Repository (abstração de dados)

- **Componente RepositorioMensagem**
  - CRUD de mensagens
  - Paginação de histórico
  - Responsabilidade: Persistência de mensagens
  - Padrão: Repository + Data Mapper

- **Componente RepositorioConversa**
  - CRUD de conversas
  - Gerenciamento de participantes
  - Responsabilidade: Persistência de conversas
  - Padrão: Repository

- **Componente RepositorioGamificacao**
  - Armazenamento de pontos, níveis, conquistas
  - Ranking
  - Responsabilidade: Persistência de gamificação
  - Padrão: Repository

- **Componente BancoDeDados**
  - Conexão com PostgreSQL
  - Pool de conexões
  - Transactions e integridade referencial
  - Responsabilidade: Acesso ao banco
  - Padrão: Singleton (uma instância de conexão)
  - Padrão: Data Access Object (DAO)

---

#### Diagrama de Componentes

**Figura 5:** Diagrama de Componentes

```
┌─────────────────────────────────────────────────────────────────┐
│                       FRONTEND (React/Next.js)                  │
│                                                                 │
│ ┌────────────────┐ ┌──────────────┐ ┌──────────────────┐       │
│ │ InterfaceApp   │ │InterfaceChat │ │ InterfacePerfil  │       │
│ │ (Router)       │ │ (Chat Room)  │ │ (User Profile)   │       │
│ └────────┬───────┘ └──────┬───────┘ └────────┬─────────┘       │
│          │                │                   │                 │
│          └────────────────┴───────────────────┘                 │
│                          │                                       │
│                    ┌─────▼──────┐                               │
│                    │  HTTP/REST  │                               │
│                    │  WebSocket  │                               │
│                    └─────┬──────┘                               │
└─────────────────────────┼──────────────────────────────────────┘
                          │ API calls
                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                    API GATEWAY / Load Balancer                  │
└─────────────────────────┬──────────────────────────────────────┘
                          │
        ┌─────────────────┴──────────────────┐
        ▼                                    ▼
┌──────────────────────────┐      ┌──────────────────────────┐
│   BACKEND (FastAPI)      │      │  WebSocket Manager       │
│                          │      │                          │
│ ┌──────────────────────┐ │      │ ┌────────────────────┐  │
│ │ ControladorAuth      │ │      │ │ Gerenciador de     │  │
│ │ ControladorChat      │ │      │ │ Conexões WebSocket │  │
│ │ ControladorNotif.    │ │      │ │                    │  │
│ │ ServicoTraducao      │ │      │ │ Publish-Subscribe  │  │
│ │ SugerirAmigos        │ │      │ │ (Por conversa)     │  │
│ │ ControladorGamif.    │ │      │ └────────────────────┘  │
│ └──────────────────────┘ │      └──────────────────────────┘
│          │               │
│     ┌────▼───────┐       │
│     │  Security  │       │
│     │ (JWT, Hash)│       │
│     └────────────┘       │
└──────────────────────────┘
        │         │
        │         └──────────────────┐
        │                            ▼
        │                    ┌─────────────────┐
        │                    │  Message Queue  │
        │                    │  (Async Tasks)  │
        │                    └─────────────────┘
        │                            │
        │                     ┌──────┴──────┐
        │                     │             │
        │                     ▼             ▼
        │         ┌──────────────┐   ┌──────────┐
        │         │SendGrid/SES  │   │  Redis   │
        │         │(Email/SMS)   │   │ (Cache)  │
        │         └──────────────┘   └──────────┘
        │
        ▼
┌──────────────────────────┐
│  REPOSITÓRIOS            │
│                          │
│ ┌────────────────────┐   │
│ │RepositorioUsuario  │   │
│ │RepositorioMensagem │   │
│ │RepositorioConversa │   │
│ │RepositorioGamef.   │   │
│ └────────────────────┘   │
│          │               │
│     ┌────▼──────────┐    │
│     │ Database Pool │    │
│     └─────┬────────┘    │
│           │             │
└───────────┼─────────────┘
            ▼
┌──────────────────────────┐
│    PostgreSQL            │
│  (Schema Persistência)   │
│                          │
│ USUARIO, PERFIL, CHAT,   │
│ MENSAGEM, AMIZADE,       │
│ SALA_TEMATICA,           │
│ GAMIFICACAO, CONQUISTA   │
└──────────────────────────┘
```

**Autoria**: [Mariiana Neris](https://github.com/Maryyscreuza), 2025.

#### Dependências Entre Componentes

| Componente | Depende de | Tipo de Dependência |
|---|---|---|
| InterfaceChat | ControladorChat, WebSocketManager | Chamada de API + WebSocket |
| ControladorChat | RepositorioMensagem, ControladorNotificacoes | Função interna |
| ControladorNotificacoes | FilaAssincrona, ServicoTraducao | Enfileiramento, Adapter |
| ServicoTraducao | APIs Google Translate / DeepL | HTTP externo |
| ControladorGamificacao | RepositorioGamificacao, ControladorNotificacoes | Função interna |
| RepositorioMensagem | BancoDeDados (PostgreSQL) | SQL queries |
| WebSocketManager | RepositorioConversa | Recuperar participantes |
| MiddlewareAutenticacao | JWT (biblioteca externa) | Validação de token |

#### Padrões de Projeto Implementados por Componente

| Componente | Padrões GoF |
|---|---|
| ControladorAutenticacao | Singleton, Factory Method |
| ControladorChat | Command, Strategy |
| ControladorNotificacoes | Observer, Abstract Factory |
| ServicoTraducao | Adapter, Facade, Decorator |
| ControladorGamificacao | State, Command |
| WebSocketManager | Observer, Publish-Subscribe |
| RepositorioUsuario | Repository, Data Mapper |
| BancoDeDados | Singleton, DAO |
| MiddlewareAutenticacao | Interceptor (padrão arquitetural) |

##  Visualização de Dados

A Visualização de Dados apresenta o modelo estrutural das entidades do sistema Correio Digital, suas chaves, atributos e relacionamentos. O diagrama demonstra como usuários, mensagens, conversas, relacionamentos sociais e mecanismos de gamificação se organizam no banco de dados relacional.

<p align="center">
  <b>Figura 6:</b> DER (Diagrama Entidade-Relacionamento)
</p>

<p align="center">
  <img src="../Assets/DER.png" alt="DER Correio Digital" width="85%">
</p>

<p align="center">
  <i>Autoria: Thales Germano, 2025.</i>
</p>


### MER – Modelo Entidade Relacionamento

<details> <summary><b>ENTIDADE: USUARIO</b></summary>

| Campo           | Descrição                           |
| --------------- | ----------------------------------- |
| `id_usuario`    | (PK) Identificador único do usuário |
| `nome`          | Nome de exibição                    |
| `email`         | E-mail único de login               |
| `senha_hash`    | Hash seguro da senha                |
| `idioma_nativo` | Idioma principal do usuário         |
| `data_cadastro` | Data e hora de criação da conta     |
| `status_conta`  | Estado da conta: ATIVO/SUSPENSO     |

Relacionamentos

USUARIO — PERFIL (1:1)

USUARIO — MENSAGEM (1:N)

USUARIO — PARTICIPANTE_CONVERSA (1:N)

USUARIO — AMIZADE (1:N, como solicitante e solicitado)

USUARIO — NOTIFICACAO (1:N)

USUARIO — GAMIFICACAO (1:1)

</details>

<details> <summary><b>ENTIDADE: PERFIL</b></summary>

| Campo             | Descrição                     |
| ----------------- | ----------------------------- |
| `id_perfil`       | (PK) Identificador do perfil  |
| `id_usuario`      | (FK) Referência ao usuário    |
| `bio`             | Biografia do usuário          |
| `tags_idiomas`    | Lista de idiomas de interesse |
| `emoji_status`    | Emoji/status curto            |
| `foto_perfil_url` | URL da foto de perfil         |

Relacionamentos

PERFIL — USUARIO (1:1)

</details>

<details> <summary><b>ENTIDADE: CONVERSA</b></summary>

| Campo              | Descrição                               |
| ------------------ | --------------------------------------- |
| `id_conversa`      | (PK) Identificador da conversa          |
| `tipo_conversa`    | INDIVIDUAL, GRUPO ou SALA               |
| `data_criacao`     | Data e hora de criação                  |
| `id_dono`          | (FK) Criador da conversa (opcional)     |
| `id_sala_tematica` | (FK) Sala temática vinculada (opcional) |

Relacionamentos

CONVERSA — MENSAGEM (1:N)

CONVERSA — PARTICIPANTE_CONVERSA (1:N)

CONVERSA — SALA_TEMATICA (N:1)

</details>

<details> <summary><b>ENTIDADE: PARTICIPANTE_CONVERSA</b></summary>

| Campo          | Descrição                     |
| -------------- | ----------------------------- |
| `id_conversa`  | (PK, FK) Conversa associada   |
| `id_usuario`   | (PK, FK) Usuário participante |
| `papel`        | PARTICIPANTE ou MODERADOR     |
| `data_entrada` | Data de entrada na conversa   |
| `data_saida`   | Data de saída (opcional)      |

Relacionamentos

PARTICIPANTE_CONVERSA — USUARIO (N:1)

PARTICIPANTE_CONVERSA — CONVERSA (N:1)

</details>

<details> <summary><b>ENTIDADE: MENSAGEM</b></summary>

| Campo                | Descrição                           |
| -------------------- | ----------------------------------- |
| `id_mensagem`        | (PK) Identificador da mensagem      |
| `id_conversa`        | (FK) Conversa à qual pertence       |
| `id_remetente`       | (FK) Usuário que enviou             |
| `conteudo`           | Conteúdo textual                    |
| `tipo_mensagem`      | TEXTO, ARQUIVO, REACAO, etc.        |
| `idioma_origem`      | Idioma detectado                    |
| `idioma_destino`     | Idioma solicitado para tradução     |
| `conteudo_traduzido` | Conteúdo pós-tradução               |
| `enviada_em`         | Data e hora de envio                |
| `editada_em`         | Data de edição                      |
| `status_entrega`     | ENVIADA, ENTREGUE, LIDA             |
| `foi_traduzida`      | Booleano indicando se foi traduzida |

Relacionamentos

MENSAGEM — CONVERSA (N:1)

MENSAGEM — USUARIO (N:1)

</details>

<details> <summary><b>ENTIDADE: AMIZADE</b></summary>

| Campo              | Descrição                     |
| ------------------ | ----------------------------- |
| `id_amizade`       | (PK) Identificador da relação |
| `id_solicitante`   | (FK) Usuário que enviou       |
| `id_solicitado`    | (FK) Usuário que recebeu      |
| `status`           | PENDENTE, ACEITA, RECUSADA    |
| `data_solicitacao` | Data da solicitação           |
| `data_resposta`    | Data da resposta              |

Relacionamentos

AMIZADE — USUARIO (N:1, solicitante)

AMIZADE — USUARIO (N:1, solicitado)

</details>

<details> <summary><b>ENTIDADE: SALA_TEMATICA</b></summary>

| Campo          | Descrição                  |
| -------------- | -------------------------- |
| `id_sala`      | (PK) Identificador da sala |
| `nome`         | Nome da sala               |
| `descricao`    | Texto descritivo           |
| `idioma`       | Idioma principal           |
| `tema`         | Tema da sala               |
| `visibilidade` | PUBLICA ou PRIVADA         |
| `id_moderador` | (FK) Usuário moderador     |

Relacionamentos

SALA_TEMATICA — CONVERSA (1:N)

SALA_TEMATICA — USUARIO (N:1, moderador)

</details>

<details> <summary><b>ENTIDADE: GAMIFICACAO</b></summary>

| Campo            | Descrição                      |
| ---------------- | ------------------------------ |
| `id_gamificacao` | (PK) Identificador do registro |
| `id_usuario`     | (FK) Dono do sistema de pontos |
| `nivel`          | Nível atual                    |
| `pontos_total`   | Pontos acumulados              |

Relacionamentos

GAMIFICACAO — USUARIO (1:1)

GAMIFICACAO — USUARIO_CONQUISTA (1:N)

</details>

<details> <summary><b>ENTIDADE: CONQUISTA</b></summary>

| Campo          | Descrição                       |
| -------------- | ------------------------------- |
| `id_conquista` | (PK) Identificador da conquista |
| `codigo`       | Código único (“MSG_100”)        |
| `nome`         | Nome da conquista               |
| `descricao`    | Texto explicativo               |
| `pontos_base`  | Pontos da conquista             |


Relacionamentos

CONQUISTA — USUARIO_CONQUISTA (1:N)

</details>

<details> <summary><b>ENTIDADE: USUARIO_CONQUISTA</b></summary>

| Campo           | Descrição                     |
| --------------- | ----------------------------- |
| `id_usuario`    | (PK, FK) Dono da conquista    |
| `id_conquista`  | (PK, FK) Conquista adquirida  |
| `data_obtencao` | Quando foi adquirida          |
| `origem_evento` | Ex.: “100 mensagens enviadas” |


Relacionamentos

USUARIO_CONQUISTA — USUARIO (N:1)

USUARIO_CONQUISTA — CONQUISTA (N:1)

</details>

<details> <summary><b>ENTIDADE: NOTIFICACAO</b></summary>

| Campo            | Descrição                                |
| ---------------- | ---------------------------------------- |
| `id_notificacao` | (PK) Identificador da notificação        |
| `id_usuario`     | (FK) Usuário destino                     |
| `tipo`           | NOVA_MENSAGEM, SOLICITACAO_AMIZADE, etc. |
| `payload`        | Dados adicionais em JSON                 |
| `lida`           | Indicador booleano                       |
| `criada_em`      | Timestamp de criação                     |

Relacionamentos

NOTIFICACAO — USUARIO (N:1)

</details>


### DLD – Dicionário de Dados

<details> <summary><b>USUARIO</b></summary>

| Campo         | Tipo         | Chave | Obrigatório | Descrição                        |
| ------------- | ------------ | ----- | ----------- | -------------------------------- |
| id_usuario    | SERIAL       | PK    | Sim         | Identificador único do usuário   |
| nome          | VARCHAR(120) | -     | Sim         | Nome de exibição                 |
| email         | VARCHAR(255) | ÚNICO | Sim         | E-mail utilizado no login        |
| senha_hash    | VARCHAR(255) | -     | Sim         | Hash seguro da senha             |
| idioma_nativo | VARCHAR(10)  | -     | Não         | Idioma principal do usuário      |
| data_cadastro | TIMESTAMP    | -     | Sim         | Data e hora do cadastro          |
| status_conta  | VARCHAR(20)  | -     | Sim         | Estado da conta (ATIVO/SUSPENSO) |

</details>

<details> <summary><b>PERFIL</b></summary>

| Campo           | Tipo         | Chave | Obrigatório | Descrição                          |
| --------------- | ------------ | ----- | ----------- | ---------------------------------- |
| id_perfil       | SERIAL       | PK    | Sim         | Identificador único do perfil      |
| id_usuario      | INT          | FK    | Sim         | Referência ao usuário proprietário |
| bio             | VARCHAR(500) | -     | Não         | Biografia do usuário               |
| tags_idiomas    | VARCHAR(255) | -     | Não         | Idiomas de interesse do usuário    |
| emoji_status    | VARCHAR(10)  | -     | Não         | Emoji/status                       |
| foto_perfil_url | VARCHAR(255) | -     | Não         | URL da foto de perfil              |

</details>

<details> <summary><b>CONVERSA</b></summary>

| Campo            | Tipo        | Chave | Obrigatório | Descrição                       |
| ---------------- | ----------- | ----- | ----------- | ------------------------------- |
| id_conversa      | SERIAL      | PK    | Sim         | Identificador da conversa       |
| tipo_conversa    | VARCHAR(15) | -     | Sim         | INDIVIDUAL, GRUPO ou SALA       |
| data_criacao     | TIMESTAMP   | -     | Sim         | Data de criação da conversa     |
| id_dono          | INT         | FK    | Não         | Dono da conversa (opcional)     |
| id_sala_tematica | INT         | FK    | Não         | Relacionada a uma sala temática |

</details>

<details> <summary><b>PARTICIPANTE_CONVERSA</b></summary>

| Campo        | Tipo        | Chave  | Obrigatório | Descrição                   |
| ------------ | ----------- | ------ | ----------- | --------------------------- |
| id_conversa  | INT         | PK, FK | Sim         | Identificador da conversa   |
| id_usuario   | INT         | PK, FK | Sim         | Identificador do usuário    |
| papel        | VARCHAR(20) | -      | Sim         | PARTICIPANTE ou MODERADOR   |
| data_entrada | TIMESTAMP   | -      | Sim         | Data de entrada na conversa |
| data_saida   | TIMESTAMP   | -      | Não         | Data de saída               |

</details>

<details> <summary><b>MENSAGEM</b></summary>

| Campo              | Tipo        | Chave | Obrigatório | Descrição                    |
| ------------------ | ----------- | ----- | ----------- | ---------------------------- |
| id_mensagem        | SERIAL      | PK    | Sim         | Identificador da mensagem    |
| id_conversa        | INT         | FK    | Sim         | Conversa à qual pertence     |
| id_remetente       | INT         | FK    | Sim         | Usuário remetente            |
| conteudo           | TEXT        | -     | Sim         | Conteúdo textual             |
| tipo_mensagem      | VARCHAR(15) | -     | Sim         | TEXTO, ARQUIVO, REACAO, etc. |
| idioma_origem      | VARCHAR(10) | -     | Não         | Idioma original              |
| idioma_destino     | VARCHAR(10) | -     | Não         | Idioma solicitado            |
| conteudo_traduzido | TEXT        | -     | Não         | Conteúdo pós-tradução        |
| enviada_em         | TIMESTAMP   | -     | Sim         | Momento do envio             |
| editada_em         | TIMESTAMP   | -     | Não         | Momento da edição            |
| status_entrega     | VARCHAR(15) | -     | Sim         | ENVIADA, ENTREGUE, LIDA      |
| foi_traduzida      | BOOLEAN     | -     | Sim         | Indica se foi traduzida      |

</details>

<details> <summary><b>AMIZADE</b></summary>

| Campo            | Tipo        | Chave | Obrigatório | Descrição                        |
| ---------------- | ----------- | ----- | ----------- | -------------------------------- |
| id_amizade       | SERIAL      | PK    | Sim         | Identificador da relação         |
| id_solicitante   | INT         | FK    | Sim         | Usuário que enviou a solicitação |
| id_solicitado    | INT         | FK    | Sim         | Usuário que recebeu              |
| status           | VARCHAR(15) | -     | Sim         | PENDENTE, ACEITA, RECUSADA       |
| data_solicitacao | TIMESTAMP   | -     | Sim         | Quando foi enviada               |
| data_resposta    | TIMESTAMP   | -     | Não         | Quando houve decisão             |

</details>

<details> <summary><b>SALA_TEMATICA</b></summary>

| Campo        | Tipo         | Chave | Obrigatório | Descrição                     |
| ------------ | ------------ | ----- | ----------- | ----------------------------- |
| id_sala      | SERIAL       | PK    | Sim         | Identificador da sala         |
| nome         | VARCHAR(100) | -     | Sim         | Nome da sala                  |
| descricao    | TEXT         | -     | Não         | Descrição do tema             |
| idioma       | VARCHAR(10)  | -     | Sim         | Idioma da sala                |
| tema         | VARCHAR(50)  | -     | Sim         | Tema principal                |
| visibilidade | VARCHAR(10)  | -     | Sim         | PUBLICA ou PRIVADA            |
| id_moderador | INT          | FK    | Sim         | Usuário moderador responsável |

</details>

<details> <summary><b>GAMIFICACAO</b></summary>

| Campo          | Tipo   | Chave | Obrigatório | Descrição                    |
| -------------- | ------ | ----- | ----------- | ---------------------------- |
| id_gamificacao | SERIAL | PK    | Sim         | Identificador da gamificação |
| id_usuario     | INT    | FK    | Sim         | Dono da gamificação          |
| nivel          | INT    | -     | Sim         | Nível atual                  |
| pontos_total   | INT    | -     | Sim         | Pontuação acumulada          |

</details>

<details> <summary><b>CONQUISTA</b></summary>

| Campo        | Tipo         | Chave | Obrigatório | Descrição                  |
| ------------ | ------------ | ----- | ----------- | -------------------------- |
| id_conquista | SERIAL       | PK    | Sim         | Identificador da conquista |
| codigo       | VARCHAR(30)  | ÚNICO | Sim         | Código único da conquista  |
| nome         | VARCHAR(100) | -     | Sim         | Nome amigável              |
| descricao    | TEXT         | -     | Sim         | Descrição detalhada        |
| pontos_base  | INT          | -     | Sim         | Pontuação atribuída        |

</details>

<details> <summary><b>USUARIO_CONQUISTA</b></summary>

| Campo         | Tipo         | Chave  | Obrigatório | Descrição                      |
| ------------- | ------------ | ------ | ----------- | ------------------------------ |
| id_usuario    | INT          | PK, FK | Sim         | Usuário que ganhou a conquista |
| id_conquista  | INT          | PK, FK | Sim         | Conquista adquirida            |
| data_obtencao | TIMESTAMP    | -      | Sim         | Data da aquisição              |
| origem_evento | VARCHAR(255) | -      | Não         | Motivo da conquista            |

</details>

<details> <summary><b>NOTIFICACAO</b></summary>

| Campo          | Tipo        | Chave | Obrigatório | Descrição                    |
| -------------- | ----------- | ----- | ----------- | ---------------------------- |
| id_notificacao | SERIAL      | PK    | Sim         | Identificador da notificação |
| id_usuario     | INT         | FK    | Sim         | Usuário destinatário         |
| tipo           | VARCHAR(50) | -     | Sim         | Tipo da notificação          |
| payload        | JSONB       | -     | Não         | Dados adicionais             |
| lida           | BOOLEAN     | -     | Sim         | Indica se foi lida           |
| criada_em      | TIMESTAMP   | -     | Sim         | Data da criação              |

</details>

##  Qualidade

Esta seção descreve os principais **atributos de qualidade** (requisitos não-funcionais) do Correio Digital e como a arquitetura proposta os atende, por meio de decisões de design, escolha de tecnologias e uso de padrões de projeto.

---

<details>
<summary><b>Usabilidade</b></summary>

| Aspecto | Descrição |
|---|---|
| Objetivo | Facilitar o uso do sistema por estudantes de idiomas, permitindo que encontrem conversas, gerenciem perfis e participem de salas temáticas com baixa curva de aprendizado. |
| Estratégias Arquiteturais | - Separação da camada de apresentação (Next.js/React), permitindo componentes reutilizáveis para chat, perfil e salas.<br>- Layout inspirado em aplicativos de mensagem populares (lista de conversas + área de chat), reduzindo esforço cognitivo.<br>- Validações de formulários no frontend e backend, com mensagens de erro claras.<br>- Interface responsiva, adaptada a desktop e dispositivos móveis por meio de CSS e componentes adaptativos. |

</details>

---

<details>
<summary><b>Segurança</b></summary>

| Aspecto | Descrição |
|---|---|
| Objetivo | Garantir a confidencialidade de mensagens, proteção de dados pessoais e impedir acesso não autorizado a recursos do sistema. |
| Estratégias Arquiteturais | - Autenticação baseada em **JWT**, emitido pelo backend e validado em cada requisição protegida.<br>- Autorização por meio de middlewares, restringindo acesso a conversas apenas aos participantes.<br>- Armazenamento de senhas utilizando **hash seguro** (ex.: bcrypt/argon2) em `senha_hash` na tabela `USUARIO`.<br>- Uso de **HTTPS** na camada de deploy para criptografia em trânsito.<br>- Validação de entrada e sanitização de dados para reduzir risco de injeção e ataques comuns.<br>- Possibilidade de aplicação de rate limiting em endpoints sensíveis (login, cadastro). |

</details>

---

<details>
<summary><b>Escalabilidade</b></summary>

| Aspecto | Descrição |
|---|---|
| Objetivo | Permitir o crescimento do número de usuários, conversas e mensagens sem necessidade de reescrever a arquitetura. |
| Estratégias Arquiteturais | - Arquitetura em **camadas** (Frontend, Backend, Banco de Dados), possibilitando o escalonamento independente de cada uma.<br>- Backend stateless na maior parte das operações (via JWT), facilitando balanceamento de carga com múltiplas instâncias.<br>- Modelo de dados relacional normalizado, permitindo futuras estratégias de **replicação** e **particionamento** em PostgreSQL (por conversa, usuário ou faixas de data).<br>- Possibilidade de separar o canal de comunicação em tempo real (WebSocket) em um serviço dedicado, escalando conforme a demanda de chat. |

</details>

---

<details>
<summary><b>Performance</b></summary>

| Aspecto | Descrição |
|---|---|
| Objetivo | Oferecer baixa latência nas operações principais (envio/recebimento de mensagens e tradução de conteúdo), mantendo boa experiência de uso. |
| Estratégias Arquiteturais | - Uso de **cache de traduções**: campos `conteudo_traduzido` e `foi_traduzida` em `MENSAGEM` evitam múltiplas chamadas à API externa para a mesma mensagem.<br>- Paginação do histórico de mensagens no backend, retornando blocos de mensagens (lazy loading) em vez de carregar todo o histórico de uma única vez.<br>- Criação de **índices** em campos de alto acesso (ex.: `id_conversa`, `id_remetente`, `enviada_em` na tabela `MENSAGEM`; `email` em `USUARIO`).<br>- Separação de tarefas não críticas em processos assíncronos (ex.: envio de notificações por e-mail/SMS), para não degradar o tempo de resposta do chat. |

</details>

##  Diagramas de Atividades

Os diagramas de atividades ilustram os fluxos de processos principais do sistema.

### Atividade 1: Login no Sistema

**Descrição**: Fluxo de autenticação do usuário no Correio Digital.

**Passos**:
1. Usuário acessa aplicação
2. Sistema exibe tela de login
3. Usuário insere credenciais (email e senha)
4. Sistema valida credenciais no banco de dados
5. Se válido: Sistema gera token JWT e redireciona para dashboard
6. Se inválido: Sistema exibe mensagem de erro e retorna ao login
7. Após 3 tentativas falhas: Sistema bloqueia temporariamente (5 minutos)

**Figura 7:** Diagrama de Atividade - Login

**Autoria**: Equipe Correio Digital, 2025.

### Atividade 2: Enviar e Traduzir Mensagem

**Descrição**: Fluxo de envio de mensagem com tradução automática opcional.

**Passos**:
1. Usuário acessa chat com outro usuário
2. Usuário digita mensagem no idioma de preferência
3. Sistema valida conteúdo (anti-spam, caracteres especiais)
4. Usuário escolhe: enviar original ou traduzir
5. **Se traduzir**:
   - Sistema envia conteúdo para API de tradução (padrão Adapter)
   - API retorna tradução no idioma do destinatário
   - Sistema armazena ambas versões (original + traduzida)
6. **Se não traduzir**:
   - Sistema armazena apenas versão original
7. Sistema envia mensagem via WebSocket para destinatário
8. Sistema atualiza interface de ambos usuários em tempo real
9. Sistema incrementa pontos de gamificação do remetente

**Figura 8:** Diagrama de Atividade - Envio de Mensagem

**Autoria**: Equipe Correio Digital, 2025.

### Atividade 3: Atualizar Perfil

**Descrição**: Fluxo de atualização de perfil do usuário.

**Passos**:
1. Usuário acessa página de perfil
2. Sistema carrega dados atuais do perfil
3. Usuário edita informações (biografia, idiomas, foto, emojis favoritos)
4. Sistema valida dados:
   - Tamanho da biografia (máx 500 caracteres)
   - Formato da imagem (JPG, PNG, máx 5MB)
   - Idiomas válidos (códigos ISO 639-1)
5. Se válido: Sistema atualiza banco de dados e cache
6. Se inválido: Sistema exibe mensagens de erro específicas
7. Sistema confirma atualização e recarrega perfil

**Figura 9:** Diagrama de Atividade - Atualização de Perfil

**Autoria**: Equipe Correio Digital, 2025.

##  Código Comprobatório

Os exemplos abaixo demonstram a implementação de padrões de projeto (GoF) no sistema Correio Digital.

###  Exemplo de Código: Padrão Adapter - Serviço de Tradução

**Contexto**: O sistema integra múltiplas APIs de tradução (Google Translate, DeepL) através de uma interface unificada.

Código do Backend (Python - FastAPI)

```python
# backend/app/services/traducao_adapter.py

from abc import ABC, abstractmethod

# Interface comum para serviços de tradução
class ServicoTraducao(ABC):
    @abstractmethod
    def traduzir(self, texto: str, idioma_origem: str, idioma_destino: str) -> str:
        pass

# Adaptador para Google Translate
class GoogleTranslateAdapter(ServicoTraducao):
    def __init__(self):
        from googletrans import Translator
        self.tradutor = Translator()
    
    def traduzir(self, texto: str, idioma_origem: str, idioma_destino: str) -> str:
        resultado = self.tradutor.translate(texto, src=idioma_origem, dest=idioma_destino)
        return resultado.text

# Adaptador para DeepL
class DeepLAdapter(ServicoTraducao):
    def __init__(self, api_key: str):
        import deepl
        self.tradutor = deepl.Translator(api_key)
    
    def traduzir(self, texto: str, idioma_origem: str, idioma_destino: str) -> str:
        resultado = self.tradutor.translate_text(texto, source_lang=idioma_origem.upper(), 
                                                   target_lang=idioma_destino.upper())
        return resultado.text
```

Código do Cliente (Frontend - Next.js/React)

```typescript
// frontend/src/services/traducaoService.ts

export interface TraducaoRequest {
  texto: string;
  idiomaOrigem: string;
  idiomaDestino: string;
}

export const traduzirMensagem = async (dados: TraducaoRequest): Promise<string> => {
  const response = await fetch('/api/traduzir', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(dados)
  });
  
  const resultado = await response.json();
  return resultado.textoTraduzido;
};
```

###  Exemplo de Código: Padrão Singleton - Configuração

Código do Backend (Python - FastAPI)

```python
# backend/app/config/singleton.py

import threading

class ConfiguracaoSistema:
    _instancia = None
    _lock = threading.Lock()
    
    def __new__(cls):
        if cls._instancia is None:
            with cls._lock:
                if cls._instancia is None:
                    cls._instancia = super().__new__(cls)
                    cls._instancia._inicializar()
        return cls._instancia
    
    def _inicializar(self):
        self.configs = {
            "max_tentativas_login": 3,
            "tempo_expiracao_token": 3600,
            "tamanho_maximo_mensagem": 5000,
            "idiomas_suportados": ["pt", "en", "es", "fr", "de"]
        }
    
    def obter_config(self, chave: str):
        return self.configs.get(chave)

# Uso
config = ConfiguracaoSistema()
max_tentativas = config.obter_config("max_tentativas_login")
```

###  Exemplo de Código: Padrão Strategy - Sugestão de Amigos

Código do Backend (Python - FastAPI)

```python
# backend/app/services/sugestao_strategy.py

from abc import ABC, abstractmethod
from typing import List

class EstrategiaSugestao(ABC):
    @abstractmethod
    def sugerir_amigos(self, usuario_id: int) -> List[dict]:
        pass

class SugestaoPorIdioma(EstrategiaSugestao):
    def sugerir_amigos(self, usuario_id: int) -> List[dict]:
        # Busca usuários que querem aprender o idioma nativo do usuário
        return [{"id": 101, "nome": "João", "idioma": "inglês"}]

class SugestaoPorInteresses(EstrategiaSugestao):
    def sugerir_amigos(self, usuario_id: int) -> List[dict]:
        # Busca usuários com tags/interesses similares
        return [{"id": 102, "nome": "Maria", "interesse": "música"}]

class GerenciadorSugestoes:
    def __init__(self, estrategia: EstrategiaSugestao):
        self._estrategia = estrategia
    
    def definir_estrategia(self, estrategia: EstrategiaSugestao):
        self._estrategia = estrategia
    
    def obter_sugestoes(self, usuario_id: int) -> List[dict]:
        return self._estrategia.sugerir_amigos(usuario_id)
```
[[5](#ref5)]


##  Gerenciamento e Controle

### Reflexões Críticas e Justificativas

#### Trade-offs e Decisões Arquiteturais

**1. Arquitetura Cliente-Servidor em Camadas vs. Microsserviços**
- **Escolha**: Optou-se por uma arquitetura em camadas tradicional (Apresentação, Lógica de Negócio, Dados)
- **Vantagens**: Menor complexidade inicial, facilidade de desenvolvimento para equipe acadêmica, deploy simplificado
- **Desvantagens**: Escalabilidade limitada comparada a microsserviços puros, acoplamento maior entre módulos
- **Justificativa**: Para o escopo do projeto acadêmico e MVPs iniciais, a simplicidade operacional supera a necessidade de escalabilidade extrema

**2. PostgreSQL (Relacional) vs. MongoDB (NoSQL)**
- **Escolha**: Banco de dados relacional PostgreSQL
- **Vantagens**: Garantia de integridade referencial (ACID), suporte a transações complexas, relacionamentos bem definidos entre usuários/mensagens/chats
- **Desvantagens**: Menos flexível para schemas dinâmicos, potencialmente mais lento em operações massivas de escrita
- **Justificativa**: As relações entre entidades (usuário-perfil-mensagem-chat) são fundamentais para o modelo de negócio, exigindo consistência transacional

**3. WebSockets vs. Polling para Chat em Tempo Real**
- **Escolha**: WebSockets para comunicação bidirecional
- **Vantagens**: Latência mínima, conexão persistente, menor overhead de rede
- **Desvantagens**: Maior complexidade de implementação, requer gerenciamento de conexões
- **Justificativa**: Essencial para experiência de chat em tempo real, permitindo entrega instantânea de mensagens

**4. Tradução Síncrona vs. Assíncrona**
- **Escolha**: Tradução síncrona com cache
- **Vantagens**: Usuário recebe resultado imediatamente, UX mais fluida
- **Desvantagens**: Pode bloquear envio de mensagem se API externa falhar
- **Justificativa**: Com cache de traduções frequentes e timeout configurado, o trade-off compensa pela experiência do usuário

#### Justificativa da Visão de Dados

A **Visão de Dados** (Seção 4.1.9) foi detalhada como visão arquiteturalmente significativa por:

1. **Complexidade dos Relacionamentos**: O sistema possui múltiplas entidades inter-relacionadas (USUARIO, PERFIL, MENSAGEM, CHAT, GAMIFICACAO, SALA_TEMATICA) com cardinalidades 1:1, 1:N e N:M que impactam diretamente a performance e consistência
2. **Requisitos de Integridade**: Restrições de integridade referencial são críticas (ex: mensagem sempre pertence a um chat válido, usuário sempre tem perfil)
3. **Otimizações de Query**: Índices e estratégias de JOIN afetam diretamente a velocidade de carregamento de chats e histórico de mensagens
4. **Conformidade com LGPD**: Mapeamento claro de dados pessoais (email, biografia, foto) necessário para atender legislação

#### Desafios e Melhorias Futuras

**Desafios Técnicos Enfrentados:**
1. **Gerenciamento de Conexões WebSocket**: Manter múltiplas conexões simultâneas estáveis sob carga
2. **Sincronização de Estado**: Garantir consistência entre cache (Redis) e banco de dados primário (PostgreSQL)
3. **Tradução em Tempo Real**: Balancear velocidade vs. qualidade de tradução, lidar com timeouts de APIs externas
4. **Gamificação Justa**: Prevenir manipulação de pontuação, garantir cálculo correto de conquistas

**Melhorias Futuras Previstas:**
1. **Migração para Microsserviços**: Separar serviços de Chat, Tradução e Gamificação em containers independentes
2. **Machine Learning**: Implementar modelo próprio de tradução para reduzir dependência de APIs externas
3. **Busca Avançada**: Adicionar Elasticsearch para busca semântica de mensagens e usuários
4. **Notificações Push**: Integrar Firebase Cloud Messaging para notificações nativas mobile
5. **Analytics**: Dashboard de métricas de uso, idiomas mais traduzidos, engajamento de salas temáticas

## Referências Bibliográficas

  1. <a id="ref1"></a> [Conceitos gerais de documentação arquitetural IEEE 1471-2000 - Recommended Practice for Architectural Description (estrutura e propósito do DAS)](https://sol.sbc.org.br/index.php/sbqs/article/download/15608/15451/) . Acesso em: nov. 2025.
  2. <a id="ref2"></a> [BASS, Len; CLEMENTS, Paul; KAZMAN, Rick - Software Architecture in Practice (arquitetura em camadas, estilos arquiteturais) ](https://ptgmedia.pearsoncmg.com/images/9780321815736/samplepages/0321815734.pdf). Acesso em: nov. 2025.
  3. <a id="ref3"></a> [GAMMA, Erich et al. - Design Patterns (padrões GoF mencionados)](https://www.kufunda.net/publicdocs/Padr%C3%B5es%20de%20Projetos%20Solu%C3%A7%C3%B5es%20Reutiliz%C3%A1veis%20(Gamma,%20Erich%20%20johnson,%20Ralph%20%20Helm%20etc.).pdf) . Acesso em: nov. 2025.
  4. <a id="ref4"></a> [Metodologia UML padrão para casos de uso
Repositórios do projeto (Entrega_01 - casos de uso documentados)](https://github.com/UnBArqDsw2025-2-Turma01/2025.2-T01-G2_CorreioDigital_Entrega_01/tree/main/docs/Base). Acesso em: nov. 2025.
  5. <a id="ref5"></a> Documentação FastAPI. Disponível em: [https://fastapi.tiangolo.com](https://fastapi.tiangolo.com/). Acesso em: nov. 2025.

  
## Histórico de Versões

| Versão | Data | Descrição | Autor(a) | Revisor(a) |
|---|---|---|---|---|
| 1.0 | 14/11/2025 | Criação do documento inicial/esqueleto | [Esther Sena](https://github.com/esmsena)  | - |
| 1.1 | 17/11/2025  | Adicionando tópicos Introdução, Representação Arquitetural,Metas e Restrições ,Visão de Casos de Uso, Visão Lógica | [Esther Sena](https://github.com/esmsena) | - |
| 1.2 | 17/11/2025  | Adicionando imagens e referências| [Esther Sena](https://github.com/esmsena) | - |
| 1.3 | 19/11/2025  | Adicionando DER, MER, DLD e atr de qualidade| [Thales Germano](https://github.com/thalesgvl) | - |
| 1.4 | 20/11/2025 | Adicionando visão de processos, a visão de deploy e a visão de implementação | [Mariiana Neris](https://github.com/Maryyscreuza) | - | - |
| 1.5 | 20/11/2025 | Adicionando Diagrama de Atividades, Código Comprobatório, Gerenciamento e controle | [Esther Sena](https://github.com/esmsena) | - |
